# Phase 5 ä½¿ç”¨è€…æ¸¬è©¦æŒ‡å—

**æ¸¬è©¦æ—¥æœŸ**: 2025-12-15  
**æ¸¬è©¦éšæ®µ**: Phase 5 - RAG Query Response  
**æ¸¬è©¦ç›®çš„**: é©—è­‰ RAG æŸ¥è©¢åŠŸèƒ½çš„å®Œæ•´ä½¿ç”¨è€…é«”é©—

## ğŸš€ å‰ç½®æº–å‚™

### 1. å•Ÿå‹• Docker Desktop
```powershell
# æ‰‹å‹•å•Ÿå‹• Docker Desktop æ‡‰ç”¨ç¨‹å¼
# æˆ–ä½¿ç”¨å‘½ä»¤å•Ÿå‹•æœå‹™
Start-Service com.docker.service
```

### 2. å•Ÿå‹•æ‰€æœ‰æœå‹™ï¼ˆä½¿ç”¨ Docker Composeï¼‰
```powershell
# åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„åŸ·è¡Œ
docker-compose up --build -d

# æª¢æŸ¥æœå‹™ç‹€æ…‹
docker-compose ps

# æŸ¥çœ‹å¾Œç«¯æ—¥èªŒï¼ˆç¢ºèªå•Ÿå‹•æˆåŠŸï¼‰
docker-compose logs backend -f
```

### 3. é©—è­‰æœå‹™å¥åº·ç‹€æ…‹
```powershell
# æª¢æŸ¥ Qdrant
curl http://localhost:6333/healthz

# æª¢æŸ¥ Backend
curl http://localhost:8000/health
```

### 4. å•Ÿå‹•å‰ç«¯é–‹ç™¼æœå‹™å™¨
```powershell
# æ–°é–‹ä¸€å€‹çµ‚ç«¯æ©Ÿ
cd frontend
npm run dev
```

## ğŸ“‹ æ¸¬è©¦å ´æ™¯

### å ´æ™¯ 1: åŸºæœ¬ RAG æŸ¥è©¢æµç¨‹ âœ… æ ¸å¿ƒåŠŸèƒ½
**ç›®æ¨™**: é©—è­‰å¾æ–‡ä»¶ä¸Šå‚³åˆ° RAG æŸ¥è©¢çš„å®Œæ•´æµç¨‹

**æ­¥é©Ÿ**:
1. é–‹å•Ÿç€è¦½å™¨è¨ªå• `http://localhost:5173`
2. ç³»çµ±è‡ªå‹•å»ºç«‹ Session
3. ä¸Šå‚³æ¸¬è©¦æ–‡ä»¶ï¼ˆä½¿ç”¨ `backend/tests/data/test_document.txt`ï¼‰
   - å…§å®¹æ‡‰åŒ…å«é—œæ–¼ "machine learning" æˆ– "RAG" çš„è³‡è¨Š
4. ç­‰å¾…æ–‡ä»¶è™•ç†å®Œæˆï¼ˆProgress bar åˆ°é” 100%ï¼‰
5. é€²å…¥èŠå¤©ä»‹é¢
6. æå‡ºå•é¡Œ: "What is machine learning?"
7. é©—è­‰: 
   - âœ… æ”¶åˆ°åŸºæ–¼æ–‡ä»¶å…§å®¹çš„å›ç­”
   - âœ… å›ç­”åŒ…å«ä¾†æºå¼•ç”¨
   - âœ… Token ä½¿ç”¨é‡é¡¯ç¤ºæ­£ç¢º
   - âœ… Retrieved chunks æ•¸é‡ > 0

**é æœŸçµæœ**: 
- ç‹€æ…‹: ANSWERED
- Token ä½¿ç”¨: 150-500 tokens
- Retrieved chunks: 1-3 chunks
- Similarity score: â‰¥ 0.6

---

### å ´æ™¯ 2: æ–‡ä»¶ç¯„åœå¤–æŸ¥è©¢ âœ… Strict RAG é©—è­‰
**ç›®æ¨™**: é©—è­‰ç³»çµ±æ‹’çµ•å›ç­”æ–‡ä»¶ç¯„åœå¤–çš„å•é¡Œ

**æ­¥é©Ÿ**:
1. ç¹¼çºŒä½¿ç”¨å ´æ™¯ 1 çš„ Session
2. æå‡ºèˆ‡ä¸Šå‚³æ–‡ä»¶ç„¡é—œçš„å•é¡Œ: "What is the capital of France?"
3. é©—è­‰:
   - âœ… æ”¶åˆ° "I cannot answer this question based on the uploaded documents" è¨Šæ¯
   - âœ… Retrieved chunks: 0
   - âœ… Token ä½¿ç”¨: 0
   - âœ… ç‹€æ…‹é¡¯ç¤ºç‚º CANNOT_ANSWER

**é æœŸçµæœ**:
- ç‹€æ…‹: CANNOT_ANSWER
- Token ä½¿ç”¨: 0 tokens
- Retrieved chunks: 0 chunks
- ç³»çµ±æ­£ç¢ºæ‹’çµ•å›ç­”

---

### å ´æ™¯ 3: å¤šè¼ªå°è©±æ¸¬è©¦ âœ… å°è©±è¨˜æ†¶
**ç›®æ¨™**: é©—è­‰èŠå¤©æ­·å²å’Œå¤šè¼ªå°è©±åŠŸèƒ½

**æ­¥é©Ÿ**:
1. ç¹¼çºŒä½¿ç”¨ç›¸åŒ Session
2. æå‡ºç¬¬ä¸€å€‹å•é¡Œ: "What is RAG?"
3. æå‡ºç¬¬äºŒå€‹å•é¡Œ: "How does it work?"
4. æå‡ºç¬¬ä¸‰å€‹å•é¡Œ: "What are the benefits?"
5. é©—è­‰:
   - âœ… èŠå¤©æ­·å²æ­£ç¢ºé¡¯ç¤ºæ‰€æœ‰è¨Šæ¯
   - âœ… ä½¿ç”¨è€…å’ŒåŠ©ç†è¨Šæ¯äº¤æ›¿é¡¯ç¤º
   - âœ… æ™‚é–“æˆ³æ­£ç¢º
   - âœ… è¨Šæ¯æ»¾å‹•åˆ°æœ€æ–°

**é æœŸçµæœ**:
- æ‰€æœ‰è¨Šæ¯æ­£ç¢ºè¨˜éŒ„
- UI è‡ªå‹•æ»¾å‹•åˆ°æœ€æ–°è¨Šæ¯
- æ­·å²è¨˜éŒ„å¯æ­£ç¢ºæª¢ç´¢

---

### å ´æ™¯ 4: ç›¸ä¼¼åº¦é–¾å€¼æ¸¬è©¦ âœ… æœç´¢å“è³ª
**ç›®æ¨™**: é©—è­‰ similarity_threshold = 0.6 çš„æ•ˆæœ

**æ­¥é©Ÿ**:
1. ä¸Šå‚³æ–°æ–‡ä»¶ï¼ˆé—œæ–¼ç‰¹å®šä¸»é¡Œï¼Œä¾‹å¦‚ "Python programming"ï¼‰
2. æå‡ºé«˜ç›¸é—œåº¦å•é¡Œ: "What is Python?" (æ‡‰è©² > 0.7)
3. æå‡ºä¸­ç­‰ç›¸é—œåº¦å•é¡Œ: "Tell me about programming" (æ‡‰è©² 0.6-0.7)
4. æå‡ºä½ç›¸é—œåº¦å•é¡Œ: "What is cooking?" (æ‡‰è©² < 0.6)
5. é©—è­‰:
   - âœ… é«˜ç›¸é—œåº¦å•é¡Œ: ANSWERED
   - âœ… ä¸­ç­‰ç›¸é—œåº¦å•é¡Œ: ANSWERED
   - âœ… ä½ç›¸é—œåº¦å•é¡Œ: CANNOT_ANSWER
   - âœ… Similarity scores åœ¨æ—¥èªŒä¸­æ­£ç¢ºé¡¯ç¤º

---

### å ´æ™¯ 5: Metrics Dashboard æ¸¬è©¦ âœ… ç›£æ§åŠŸèƒ½
**ç›®æ¨™**: é©—è­‰å³æ™‚ Metrics æ›´æ–°å’Œé¡¯ç¤º

**æ­¥é©Ÿ**:
1. é–‹å•Ÿ Metrics Dashboardï¼ˆé»æ“Š "Show Metrics" æŒ‰éˆ•ï¼‰
2. æå‡ºå¤šå€‹æŸ¥è©¢ï¼ˆè‡³å°‘ 5 å€‹ï¼‰
3. è§€å¯Ÿ Metrics æ›´æ–°
4. é©—è­‰:
   - âœ… Total Queries è¨ˆæ•¸æ­£ç¢ºå¢åŠ 
   - âœ… Token ä½¿ç”¨é‡ç´¯è¨ˆæ­£ç¢º
   - âœ… Average tokens per query è¨ˆç®—æ­£ç¢º
   - âœ… Unanswered ratio æ­£ç¢ºé¡¯ç¤º
   - âœ… é€²åº¦æ¢æ ¹æ“šä½¿ç”¨é‡èª¿æ•´é¡è‰²ï¼ˆç¶ è‰²/æ©™è‰²ï¼‰
   - âœ… Token è­¦å‘Šï¼ˆâ‰¥10000ï¼‰é¡¯ç¤ºæ­£ç¢º

**é æœŸçµæœ**:
- Metrics æ¯ 3 ç§’æ›´æ–°ä¸€æ¬¡
- æ‰€æœ‰çµ±è¨ˆæ•¸æ“šæº–ç¢º
- UI éŸ¿æ‡‰æµæš¢

---

### å ´æ™¯ 6: å¤šèªè¨€ä»‹é¢æ¸¬è©¦ âœ… åœ‹éš›åŒ–
**ç›®æ¨™**: é©—è­‰ 7 ç¨®èªè¨€åˆ‡æ›åŠŸèƒ½

**æ­¥é©Ÿ**:
1. é»æ“Šèªè¨€é¸æ“‡å™¨æŒ‰éˆ•
2. è§€å¯ŸæŒ‰éˆ•æ–‡å­—æ¯ 1 ç§’å¾ªç’°è®ŠåŒ–
3. ä¾æ¬¡é¸æ“‡æ¯ç¨®èªè¨€:
   - English
   - ä¸­æ–‡ï¼ˆç¹é«”ï¼‰
   - í•œêµ­ì–´
   - EspaÃ±ol
   - æ—¥æœ¬èª
   - Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
   - FranÃ§ais
4. é©—è­‰:
   - âœ… UI æ‰€æœ‰æ–‡å­—ç«‹å³æ›´æ–°
   - âœ… èŠå¤©æ­·å²å…§å®¹ä¿æŒåŸèªè¨€
   - âœ… ç³»çµ±è¨Šæ¯ä½¿ç”¨æ–°èªè¨€
   - âœ… é˜¿æ‹‰ä¼¯èª RTL ä½ˆå±€æ­£ç¢º

---

### å ´æ™¯ 7: Session ç”Ÿå‘½é€±æœŸæ¸¬è©¦ âœ… TTL åŠŸèƒ½
**ç›®æ¨™**: é©—è­‰ Session 30 åˆ†é˜ TTL å’Œé‡å•ŸåŠŸèƒ½

**æ­¥é©Ÿ**:
1. å»ºç«‹æ–° Session ä¸¦ä¸Šå‚³æ–‡ä»¶
2. è¨˜éŒ„ Session ID
3. é»æ“Š "Restart" æŒ‰éˆ•
4. ç¢ºèªé‡å•Ÿå°è©±æ¡†
5. é©—è­‰:
   - âœ… èˆŠ Session æ­£ç¢ºé—œé–‰
   - âœ… æ–° Session ID ç”Ÿæˆ
   - âœ… Qdrant collection å·²åˆªé™¤ï¼ˆèˆŠï¼‰å’Œé‡å»ºï¼ˆæ–°ï¼‰
   - âœ… èŠå¤©æ­·å²æ¸…ç©º
   - âœ… è¿”å›ä¸Šå‚³ç•«é¢

**é æœŸçµæœ**:
- Session å®Œå…¨é‡ç½®
- è³‡æ–™æ­£ç¢ºæ¸…ç†
- ç„¡è³‡æ–™æ®˜ç•™

---

### å ´æ™¯ 8: éŒ¯èª¤è™•ç†æ¸¬è©¦ âœ… å¥å£¯æ€§
**ç›®æ¨™**: é©—è­‰å„ç¨®éŒ¯èª¤æƒ…å¢ƒçš„è™•ç†

**æ­¥é©Ÿ**:
1. **ç„¡æ•ˆ Session ID**: 
   - ä½¿ç”¨ä¸å­˜åœ¨çš„ Session ID ç™¼é€æŸ¥è©¢
   - é æœŸ: 404 éŒ¯èª¤ï¼Œæ¸…æ™°çš„éŒ¯èª¤è¨Šæ¯
2. **ç©ºæŸ¥è©¢**:
   - æäº¤ç©ºç™½æŸ¥è©¢
   - é æœŸ: å‰ç«¯é©—è­‰é˜»æ­¢æäº¤
3. **è¶…é•·æŸ¥è©¢**:
   - æäº¤è¶…é 2000 å­—å…ƒçš„æŸ¥è©¢
   - é æœŸ: å‰ç«¯é¡¯ç¤ºå­—æ•¸é™åˆ¶æç¤º
4. **Session ç‹€æ…‹éŒ¯èª¤**:
   - åœ¨æ–‡ä»¶å°šæœªä¸Šå‚³æ™‚å˜—è©¦æŸ¥è©¢
   - é æœŸ: éŒ¯èª¤è¨Šæ¯æç¤ºéœ€å…ˆä¸Šå‚³æ–‡ä»¶

---

### å ´æ™¯ 9: æ•ˆèƒ½æ¸¬è©¦ âœ… éŸ¿æ‡‰æ™‚é–“
**ç›®æ¨™**: é©—è­‰ç³»çµ±éŸ¿æ‡‰é€Ÿåº¦

**æ­¥é©Ÿ**:
1. ä¸Šå‚³ä¸­ç­‰å¤§å°æ–‡ä»¶ï¼ˆ3-5 é  PDFï¼‰
2. è¨˜éŒ„è™•ç†æ™‚é–“
3. æå‡º 10 å€‹æŸ¥è©¢
4. è¨˜éŒ„æ¯å€‹æŸ¥è©¢çš„éŸ¿æ‡‰æ™‚é–“
5. é©—è­‰:
   - âœ… æ–‡ä»¶è™•ç†: < 30 ç§’
   - âœ… æŸ¥è©¢éŸ¿æ‡‰: < 3 ç§’
   - âœ… Metrics æ›´æ–°: < 1 ç§’
   - âœ… èªè¨€åˆ‡æ›: < 500ms

---

### å ´æ™¯ 10: ä¸¦ç™¼ Session æ¸¬è©¦ âœ… éš”é›¢æ€§
**ç›®æ¨™**: é©—è­‰å¤šå€‹ Session çš„éš”é›¢

**æ­¥é©Ÿ**:
1. é–‹å•Ÿå…©å€‹ç€è¦½å™¨åˆ†é 
2. æ¯å€‹åˆ†é å»ºç«‹ç¨ç«‹ Session
3. ä¸Šå‚³ä¸åŒä¸»é¡Œçš„æ–‡ä»¶ï¼ˆä¾‹å¦‚: åˆ†é  1 ä¸Šå‚³ "AI", åˆ†é  2 ä¸Šå‚³ "Cooking"ï¼‰
4. åœ¨å…©å€‹åˆ†é ä¸­æå‡ºç›¸åŒå•é¡Œ
5. é©—è­‰:
   - âœ… æ¯å€‹ Session åªèƒ½å›ç­”è‡ªå·±çš„æ–‡ä»¶å…§å®¹
   - âœ… ä¸æœƒå‡ºç¾è·¨ Session è³‡æ–™æ´©æ¼
   - âœ… Session ID ä¸åŒ
   - âœ… Qdrant collection åç¨±ä¸åŒ

---

## ğŸ› å·²çŸ¥å•é¡Œå’Œæ³¨æ„äº‹é …

1. **Backend Auto-Shutdown**: 
   - **å·²è§£æ±º**: ä½¿ç”¨ Docker å®¹å™¨åŒ–
   - å¦‚é‡åˆ°å•é¡Œï¼Œæª¢æŸ¥ `docker-compose logs backend`

2. **Similarity Threshold**:
   - ç•¶å‰è¨­å®š: 0.6ï¼ˆå·²å¾ 0.7 é™ä½ï¼‰
   - å¦‚æœå¤ªå¤š CANNOT_ANSWERï¼Œè€ƒæ…®é™è‡³ 0.5

3. **Token é™åˆ¶**:
   - Gemini API æœ‰æ¯æ—¥é…é¡é™åˆ¶
   - æ¸¬è©¦æ™‚æ³¨æ„ Token ä½¿ç”¨é‡

4. **Qdrant è³‡æ–™æŒä¹…åŒ–**:
   - Docker volume: `qdrant_storage`
   - è³‡æ–™æœƒåœ¨å®¹å™¨é‡å•Ÿå¾Œä¿ç•™

## âœ… æ¸¬è©¦å®Œæˆæª¢æŸ¥æ¸…å–®

- [ ] å ´æ™¯ 1: åŸºæœ¬ RAG æŸ¥è©¢æµç¨‹
- [ ] å ´æ™¯ 2: æ–‡ä»¶ç¯„åœå¤–æŸ¥è©¢
- [ ] å ´æ™¯ 3: å¤šè¼ªå°è©±æ¸¬è©¦
- [ ] å ´æ™¯ 4: ç›¸ä¼¼åº¦é–¾å€¼æ¸¬è©¦
- [ ] å ´æ™¯ 5: Metrics Dashboard æ¸¬è©¦
- [ ] å ´æ™¯ 6: å¤šèªè¨€ä»‹é¢æ¸¬è©¦
- [ ] å ´æ™¯ 7: Session ç”Ÿå‘½é€±æœŸæ¸¬è©¦
- [ ] å ´æ™¯ 8: éŒ¯èª¤è™•ç†æ¸¬è©¦
- [ ] å ´æ™¯ 9: æ•ˆèƒ½æ¸¬è©¦
- [ ] å ´æ™¯ 10: ä¸¦ç™¼ Session æ¸¬è©¦

## ğŸ“Š æ¸¬è©¦çµæœè¨˜éŒ„

### æ¸¬è©¦ç’°å¢ƒ
- æ—¥æœŸ: ___________
- æ¸¬è©¦äººå“¡: ___________
- Docker ç‰ˆæœ¬: ___________
- ç€è¦½å™¨: ___________

### é€šé/å¤±æ•—çµ±è¨ˆ
- é€šé: ___/10
- å¤±æ•—: ___/10
- é˜»æ“‹: ___/10

### é‡å¤§ç™¼ç¾
_è¨˜éŒ„ä»»ä½•é‡å¤§å•é¡Œæˆ–æ”¹é€²å»ºè­°_

---

## ğŸ”§ ç–‘é›£æ’è§£

### å¾Œç«¯ç„¡æ³•å•Ÿå‹•
```powershell
# æª¢æŸ¥å®¹å™¨æ—¥èªŒ
docker-compose logs backend

# é‡å»ºå®¹å™¨
docker-compose down
docker-compose up --build -d
```

### å‰ç«¯ç„¡æ³•é€£æ¥å¾Œç«¯
```powershell
# æª¢æŸ¥ CORS è¨­å®š
# ç¢ºèª .env.local ä¸­ CORS_ORIGINS åŒ…å« http://localhost:5173

# æª¢æŸ¥å¾Œç«¯å¥åº·ç‹€æ…‹
curl http://localhost:8000/health
```

### Qdrant é€£æ¥å¤±æ•—
```powershell
# æª¢æŸ¥ Qdrant å®¹å™¨
docker-compose ps qdrant

# é‡å•Ÿ Qdrant
docker-compose restart qdrant
```

---

**æœ€å¾Œæ›´æ–°**: 2025-12-15  
**ç¶­è­·è€…**: GitHub Copilot
