# Phase 6 - 多語言 UI 語言切換測試指南

**日期**: 2025-12-17  
**Phase**: 6 (US4 - Real-time Multilingual UI Language Switching)  
**任務代碼**: T073-T077  
**狀態**: 待測試  

---

## 📋 測試涵蓋範圍

本文檔涵蓋 Phase 6 (US4) 的完整測試計劃，驗證以下功能：

### T073: 語言選擇器循環動畫
- [ ] 語言選擇按鈕文本每 1 秒循環一次顯示 7 種語言名稱
- [ ] 動畫流暢，無卡頓
- [ ] 下拉菜單打開時停止循環
- [ ] 循環順序: English → 中文 → 한국어 → Español → 日本語 → العربية → Français

### T074: RTL 布局支持 (阿拉伯語)
- [ ] 選擇阿拉伯語時，UI 自動切換到 RTL 模式
- [ ] HTML 根元素添加 `dir="rtl"`
- [ ] 文本對齐右側
- [ ] 按鈕和菜單位置反轉
- [ ] 所有組件在 RTL 模式下正確顯示

### T075: 語言改變處理器 & 後端同步
- [ ] 選擇語言時立即更新 UI
- [ ] 後端 PUT /session/{sessionId}/language 被調用
- [ ] 沒有 sessionId 時，本地語言狀態仍更新
- [ ] 錯誤處理: 後端同步失敗不阻止前端語言切換

### T076: 驗證所有組件使用 i18n
- [ ] Header 組件使用翻譯鍵
- [ ] UploadScreen 組件使用翻譯鍵  
- [ ] ChatScreen 組件使用翻譯鍵
- [ ] SettingsModal 組件使用翻譯鍵
- [ ] 所有硬編碼文字已替換為 `t()` 調用
- [ ] 所有 7 種語言都有完整翻譯

### T077: 語言切換完整流程測試
- [ ] 創建新會話，選擇不同語言
- [ ] 上傳文檔時改變語言，驗證 UI 實時更新
- [ ] 聊天過程中改變語言，驗證：
  - UI 標籤立即翻譯
  - 聊天記錄保持原語言
  - 後續回應使用新語言
- [ ] 切換到阿拉伯語，驗證 RTL 完整性

---

## 🧪 測試用例

### 用例 1: 語言選擇器循環動畫
**前置條件**: 應用已開啟  
**步驟**:
1. 打開應用首頁
2. 觀察語言選擇按鈕
3. 計時觀察 1 分鐘，驗證文本每秒改變

**預期結果**:
- 按鈕文本按循環順序顯示 7 種語言
- 無跳躍或重複
- 動畫流暢

**驗證點**:
```
時刻 0s: "English"
時刻 1s: "中文"
時刻 2s: "한국어"
時刻 3s: "Español"
時刻 4s: "日本語"
時刻 5s: "العربية"
時刻 6s: "Français"
時刻 7s: "English" (循環重新開始)
```

---

### 用例 2: 下拉菜單與語言選擇
**前置條件**: 應用已開啟  
**步驟**:
1. 點擊語言選擇按鈕打開下拉菜單
2. 驗證下拉菜單顯示所有 7 種語言
3. 驗證當前語言有 ✓ 標記
4. 點擊不同語言，例如 "中文"

**預期結果**:
- 下拉菜單打開時循環動畫停止
- 7 種語言全部可見
- 選中的語言有勾選標記
- 點擊後菜單關閉，語言變更應用

---

### 用例 3: RTL 布局測試 (阿拉伯語)
**前置條件**: 應用已開啟  
**步驟**:
1. 點擊語言選擇器
2. 選擇 "العربية" (阿拉伯語)
3. 觀察以下變化：
   - 網頁方向 (dir="rtl")
   - 文本對齐
   - 按鈕位置
   - 輸入框文本方向

**預期結果**:
- HTML `dir` 屬性變為 `rtl`
- 所有文本右對齐
- 按鈕組反轉
- 輸入框和文本區域支援 RTL 輸入
- 無布局破損

**驗證命令** (瀏覽器控制台):
```javascript
console.log(document.documentElement.dir);  // 應輸出: "rtl"
console.log(document.documentElement.lang); // 應輸出: "ar"
```

---

### 用例 4: 後端同步驗證
**前置條件**: 應用已開啟且已建立會話  
**步驟**:
1. 打開瀏覽器開發者工具 (F12) → Network 標籤
2. 選擇新語言，例如 "日本語"
3. 檢查 Network 標籤中的 API 調用

**預期結果**:
- 應看到 `PUT /api/v1/session/{sessionId}/language` 請求
- 請求體包含: `{"language": "ja"}`
- 響應狀態碼: 200
- 響應體包含更新的 session 信息

**驗證命令** (瀏覽器控制台):
```javascript
// 檢查最近的語言更新
const logs = console.memory.logs || [];
console.log('Language change logged');
```

---

### 用例 5: 聊天過程中改變語言
**前置條件**:
- 應用已開啟
- 已建立會話
- 已上傳文檔
- 已發送至少一條查詢

**步驟**:
1. 在聊天屏幕上，選擇不同語言 (例如 "Español")
2. 驗證 UI 元素立即更新：
   - 發送按鈕文本
   - 輸入框佔位符
   - 系統消息
3. 發送新查詢
4. 驗證回應使用西班牙語消息

**預期結果**:
- 語言改變立即生效 (<500ms)
- 之前的聊天記錄保持原語言
- 新回應的系統消息為西班牙語
- 無性能下降

---

### 用例 6: 無會話時改變語言
**前置條件**: 應用已開啟但尚未建立會話  
**步驟**:
1. 在應用加載中，點擊語言選擇器
2. 選擇不同語言
3. 等待會話建立

**預期結果**:
- 語言立即改變 (本地更新)
- 會話使用選定語言建立
- 後端同步延遲到會話建立後
- 無錯誤或警告

---

### 用例 7: 快速連續改變語言
**前置條件**: 應用已開啟，已建立會話  
**步驟**:
1. 快速點擊語言選擇器多次
2. 快速選擇不同語言: en → zh → ja → ar → en

**預期結果**:
- 所有請求排隊正確處理
- UI 最終狀態正確
- 無重疊或衝突
- 後端最後狀態與 UI 一致

---

### 用例 8: 瀏覽器刷新後保留語言設置
**前置條件**: 應用已開啟，已選擇特定語言 (例如 "한국어")  
**步驟**:
1. 刷新瀏覽器 (F5)
2. 觀察應用重新加載

**預期結果**:
- 應用重新加載後仍使用韓語
- localStorage 中保存了語言偏好
- 不需要重新選擇語言

**驗證命令** (瀏覽器控制台):
```javascript
console.log(localStorage.getItem('i18nextLng'));      // 應顯示: "ko"
console.log(localStorage.getItem('rag-chatbot-language')); // 應顯示: "ko"
```

---

### 用例 9: 所有 7 種語言完整性檢查
**前置條件**: 應用已開啟  
**步驟**:
循環測試每種語言:
1. 選擇語言
2. 驗證以下元素已翻譯：
   - 應用標題
   - 按鈕文本 (上傳、發送、離開等)
   - 占位符文本
   - 系統消息
   - 錯誤消息

**語言列表**:
- [ ] English (en)
- [ ] 中文 (zh)
- [ ] 한국어 (ko)
- [ ] Español (es)
- [ ] 日本語 (ja)
- [ ] العربية (ar) - 特別檢查 RTL
- [ ] Français (fr)

---

## 📊 測試檢查清單

### 開始前檢查清單
- [ ] 應用已構建: `npm run build` (前端)
- [ ] 後端已啟動: `python -m uvicorn src.main:app --host 0.0.0.0 --port 8000`
- [ ] Qdrant 已運行: Docker 或本地
- [ ] Gemini API 密鑰已配置 (.env)
- [ ] 瀏覽器已打開: Chrome/Firefox/Safari/Edge (最近 2 個版本)

### 測試過程檢查清單
- [ ] T073 循環動畫驗證通過
- [ ] T074 RTL 支持驗證通過
- [ ] T075 後端同步驗證通過
- [ ] T076 i18n 翻譯完整性檢查通過
- [ ] T077 完整流程測試通過
- [ ] 所有 7 種語言測試通過
- [ ] 無控制台錯誤或警告
- [ ] 無視覺破損 (布局、文本溢出等)
- [ ] 性能可接受 (<500ms 響應)

### 後期檢查清單  
- [ ] 提交代碼改動到分支
- [ ] 更新 PROGRESS.md
- [ ] 所有測試用例記錄結果
- [ ] 任何問題已記錄到故障排除指南

---

## 🐛 故障排除

### 問題 1: 語言循環動畫不顯示
**可能原因**:
- LanguageSelector 組件未加載
- useInterval 依賴項不正確

**解決步驟**:
1. 檢查瀏覽器控制台是否有錯誤
2. 驗證 LanguageSelector.tsx 中的 useEffect
3. 確認 CYCLE_INTERVAL = 1000

### 問題 2: RTL 不工作
**可能原因**:
- CSS 文件未導入
- HTML dir 屬性未設置

**解決步驟**:
1. 驗證 rtl.css 已在 main.tsx 導入
2. 檢查 i18n 配置中的 languageChanged 事件
3. 驗證 document.documentElement.dir 已更新

### 問題 3: 後端同步失敗
**可能原因**:
- sessionId 為 null
- API 端點不可用

**解決步驟**:
1. 檢查網絡請求 (F12 → Network)
2. 驗證會話已建立
3. 檢查後端錯誤日誌

### 問題 4: 翻譯缺失
**可能原因**:
- 翻譯鍵不存在
- i18n 配置不正確

**解決步驟**:
1. 驗證 i18n/locales/*.json 包含所需鍵
2. 檢查翻譯鍵拼寫 (大小寫敏感)
3. 測試 `t('key.path')` 調用

---

## 📈 性能指標

應記錄以下性能指標:

| 操作 | 目標 | 實際 | 狀態 |
|------|------|------|------|
| 語言選擇 | <500ms | - | - |
| UI 更新 | <200ms | - | - |
| RTL 應用 | <300ms | - | - |
| 後端同步 | <1s | - | - |
| 聊天消息加載 | <2s | - | - |

---

## 📝 測試結果記錄

### 日期: _________
### 測試人員: _________

#### 用例 1: 循環動畫
結果: ☐ 通過 ☐ 失敗  
備註: ___________

#### 用例 2: 下拉菜單
結果: ☐ 通過 ☐ 失敗  
備註: ___________

#### 用例 3: RTL
結果: ☐ 通過 ☐ 失敗  
備註: ___________

#### 用例 4: 後端同步
結果: ☐ 通過 ☐ 失敗  
備註: ___________

#### 用例 5: 聊天語言切換
結果: ☐ 通過 ☐ 失敗  
備註: ___________

#### 用例 6: 無會話狀態
結果: ☐ 通過 ☐ 失敗  
備註: ___________

#### 用例 7: 快速切換
結果: ☐ 通過 ☐ 失敗  
備註: ___________

#### 用例 8: 持久化
結果: ☐ 通過 ☐ 失敗  
備註: ___________

#### 用例 9: 完整性 (所有 7 語言)
結果: ☐ 通過 ☐ 失敗  
備註: ___________

---

## ✅ 最終驗收

**所有測試通過**: ☐ 是 ☐ 否  
**發現的問題**: ___________  
**建議**: ___________  

**簽字**: _________________ **日期**: _________

---

## 📚 相關文檔

- [PROGRESS.md](./PROGRESS.md) - 專案進度追蹤
- [plan.md](../specs/001-multilingual-rag-chatbot/plan.md) - 實現計劃
- [spec.md](../specs/001-multilingual-rag-chatbot/spec.md) - 功能規格書
- [TROUBLESHOOTING_GUIDE.md](./TROUBLESHOOTING_GUIDE.md) - 故障排除指南
